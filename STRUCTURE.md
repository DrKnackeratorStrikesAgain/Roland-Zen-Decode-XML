# ZenProperties Output Structure Reference

Compact reference for LLMs working with Roland Zen XML decoder output.

## Top-Level Structure

The output is a single object `ZenProperties` containing blocks as top-level properties:

```javascript
ZenProperties = {
  "BLOCK_NAME": { /* block definition */ },
  "ANOTHER_BLOCK": { /* block definition */ },
  // ... more blocks
}
```

**Note**: From the output perspective, everything is a block. The distinction between blocks, groups, and subblocks is only relevant in the source XML. In the output, they all have the same structure.

## Block Structure

```typescript
{
  name: string;              // Block identifier (e.g., "INST_CMN")
  description: string;       // Human-readable description
  byteLength: number;        // Total size in bytes
  category?: string;         // Category name (e.g., "Autogenerated: jupiter")
  sysexLength?: number;      // Total size in sysex (if includeSysex enabled)
  parameters: {              // Object keyed by parameter ID
    "PARAM_ID": { /* parameter definition */ }
  }
}
```

A block's `parameters` object can contain:
- Regular parameters (with data values)
- Block reference parameters (referencing other blocks, possibly as arrays)
- Padding parameters (unused/reserved space)

## Parameter Types

### 1. Regular Parameter

Standard parameter with data values:

```typescript
{
  id: string;                    // Parameter identifier
  byteOffset: number;            // Byte offset from block start
  byteLength: number;            // Size in bytes (1 or 2)
  description: string;            // Human-readable description
  dataRange: [number, number];   // [min, max] valid range
  initValue: number;             // Initial/default value
  
  // Optional fields:
  sysexOffset?: number;          // Sysex offset (if includeSysex)
  lengthSysex?: number;          // Sysex length (1, 2, or 4)
  sysexValueOffset?: number;     // Binary-to-sysex value offset
  values?: { [key: string]: string };  // Value map: "0" => "OFF", "1" => "ON"
  displayMeasurement?: string;    // Unit: "ms", "db", "cent", "ASCII"
  displayRange?: [string, string]; // Scaled display range
}
```

### 2. Block Reference Parameter

Parameter that references another block (may be an array of blocks):

```typescript
{
  id: string;                    // Parameter ID
  blockName: string;             // Name of referenced block (e.g., "INST_CMN_WMT")
  count: number;                 // Number of array instances
  byteOffset: number;            // Base offset for item #0
  blockByteLength: number;       // Size of single instance
  byteLength: number;            // Total size (blockByteLength * count)
  description: string;
  
  // Optional:
  sysexOffset?: string;          // Sysex offset as space-separated hex (e.g., "00 01 00")
  sysexItemSize?: number;        // Sysex size per item
  
  // JS version only:
  block?: Block;                 // Direct reference to ZenProperties[blockName]
}
```

**Array Address Calculation**: For item `i`, calculate address as: `address = byteOffset + (i * blockByteLength)`

### 3. Padding Parameter

Special parameter marking unused/reserved space:

```typescript
{
  id: string;                    // Always "PADDING" + number
  byteOffset: number;
  byteLength: number;
  description: string;           // Always "__padding"
  dataRange: [0, 0];
  initValue: null;
  isPadding: true;               // Only present when true
}
```


## Category Field

- All blocks have a `category` field
- Format: `"Autogenerated: <config_name>"`
- Used for organizing HTML output
- If missing, defaults to `"Unnamed Category"` in HTML generation

## JS vs JSON Output

**JSON**: Block references use `blockName` string only.

**JS**: Block references include `block` property with direct object reference:
```javascript
block: ZenProperties["BLOCK_NAME"]
```

## Common Patterns

### Accessing Parameters
```javascript
const block = ZenProperties["INST_CMN"];
const param = block.parameters["NAME_1"];
```

### Iterating Array Items (Block Reference)
```javascript
const blockRef = block.parameters["WMT"];
for (let i = 0; i < blockRef.count; i++) {
  const address = blockRef.byteOffset + (i * blockRef.blockByteLength);
  // Access item at address
}
```

### Checking Parameter Type
```javascript
if (param.blockName) {
  // It's a block reference
} else if (param.isPadding) {
  // It's padding
} else {
  // Regular parameter
}
```

## Field Presence Rules

- `isPadding`: Only present when `true` (omitted for non-padding)
- `category`: Always present in generated output
- `sysexOffset`, `lengthSysex`, `sysexValueOffset`: Only if `includeSysex: true`
- `values`: Present when parameter has value mappings, otherwise omitted
- `displayMeasurement`, `displayRange`: Only for parameters with display scaling
- `block`: Only in JS output, only for block reference parameters
